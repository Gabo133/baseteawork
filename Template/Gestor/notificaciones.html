{% extends "Partials/Gestor/_Base.html" %}
{% load static %}
{% block Title %}
Inicio
{% endblock Title %}
{% block Style %}
<style>
	.punt {
    cursor: pointer;
}

</style>
{% endblock Style %}
{% block Content %}
<div class="section__content section__content--p30">
	<div class="container-fluid">
		<div class="row justify-content-md-center">
			<div class="col-md-7">
				<div class="card" style="background: rgba(255, 255, 255, 0.5);color:black; color:black;">
					<div class="card-body">
						<h2 style="text-align: center;">Notificaciones</h2>
						<br>
						<div class="table-responsive table--no-card m-b-30">
							<table class="table table-striped">
								<tbody>
									{% for i in contacts %}
									<tr id="tr{{i.0.pk}}">
										<td width="100px"><img src="{% static i.1 %}" alt="" width="50px" ></td>
										{% if i.0.Empresa.Tipo == 'Tr' %}
										<td class="punt" href="{% url 'Redirect_Noti' i.0.pk i.0.Empresa.pk %}" >
											<div>
												<h3>{{i.0.Empresa.Nombre_Empresa}}</h3>
											</div>
											<p style="color:gray">{{i.0.Mensaje}}</p>
										{% else %}
										</td>
										<td class="punt" href="{% url 'Redirect_Noti' i.0.pk i.0.Empresa.pk %}" >
											<div>
												<h3>{{i.0.Empresa.Nombre_Empresa}}</h3>
											</div>
											<p style="color:gray">{{i.0.Mensaje}}</p>
										</td>
										{% endif %}
										<td width="200px">
											<p>{{i.0.Fecha}}</p>
										</td>
										<td>
											<button id="elim{{i.0.pk}}" class="btn btn-danger">Eliminar</button>
										</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
						<div class="row">
					      <ul class="pagination">
					        {% if contacts.has_previous %}
					        <li class="page-item">
					          <a class="page-link" href="?page={{ contacts.previous_page_number }}{{searchFilter}}">Anterior</a>
					        </li>
					        {% else %}
					        <li class="page-item disabled">
					          <a class="page-link">Anterior</a>
					        </li>
					        {% endif %} {% if contacts.number|add:'-4' > 1 %}
					        <li><a href="?page={{ contacts.number|add:'-5' }}{{searchFilter}}">&hellip;</a></li>
					        {% endif %} {% for i in contacts.paginator.page_range %} {% if contacts.number == i %}
					        <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
					        {% elif i > contacts.number|add:'-5' and i < contacts.number|add:'5' %} <li><a href="?page={{ i }}{{searchFilter}}">{{i}}</a></li>
					          {% endif %} {% endfor %} {% if contacts.paginator.num_pages > contacts.number|add:'4' %}
					          <li><a href="?page={{ contacts.number|add:'5' }}{{searchFilter}}">&hellip;</a></li>
					          {% endif %} {% if contacts.has_next %}
					          <li class="page-item">
					            <a class="page-link" href="?page={{ contacts.next_page_number }}{{searchFilter}}">Siguiente</a>
					          </li>
					          {% else %}
					          <li class="page-item disabled">
					            <a class="page-link">Siguiente</a>
					          </li>
					          {% endif %}
					      </ul>
					    </div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock Content %}
{% block JavaScript %}
<script>
	$(document).ready(function(){
	function getCookie(name){
      var cookieValue = null;
      if (document.cookie && document.cookie != ''){
          var cookies = document.cookie.split(';');
          for(var i = 0; i < cookies.length; i++){
              var cookie = jQuery.trim(cookies[i]);

              if(cookie.substring(0,name.length + 1) == (name + '=')){
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue
    }
    $('.punt').click(function(){
        window.location = $(this).attr('href');
        return false;
    });
    {% for i in contacts%}
	    $("#elim{{i.0.pk}}").on('click', function(event) {

	    	$.ajax({
	          url:'{% url "Notificaciones" %}',
	          type: "POST",
	          data: {
	            csrfmiddlewaretoken: getCookie('csrftoken'),
	            'pk' : '{{i.0.pk}}'
	          },
	          success: function() {
			    event.preventDefault();  //stop the browser from following
	          	$("#tr{{i.0.pk}}").remove();
			}                                          
	        });
	    });
    {% endfor %}
});
</script>
{% endblock JavaScript %}